<script>
        var taskManager = {
            tasks: [],
            notifications: [],
            alertCounter: 0,
            currentUser: 'Admin',
            teamMembers: ['LUCIANO', 'ANTONIO', 'LUIGI', 'DARIO', 'NOEMI', 'VINCENZO', 'ROBERTO', 'MARIANO'],
            currentView: 'lista',
            editingTaskId: null,
            filters: { assignee: 'tutti', priority: 'tutte', status: 'tutti', tags: [] },
            taskStates: {
                'da-iniziare': { label: 'üìã Da Iniziare', class: 'status-da-iniziare' },
                'in-corso': { label: 'üöÄ In Corso', class: 'status-in-corso' },
                'in-revisione': { label: 'üëÅÔ∏è In Revisione', class: 'status-in-revisione' },
                'completato': { label: '‚úÖ Completato', class: 'status-completato' },
                'in-pausa': { label: '‚è∏Ô∏è In Pausa', class: 'status-in-pausa' },
                'annullato': { label: '‚ùå Annullato', class: 'status-annullato' }
            },
            priorities: {
                'alta': { label: 'üî¥ Alta', class: 'priority-alta' },
                'media': { label: 'üü° Media', class: 'priority-media' },
                'bassa': { label: 'üü¢ Bassa', class: 'priority-bassa' }
            }
        };

        var teamContacts = {
            'LUCIANO': { email: 'luciano@gruppovisconti.it', whatsapp: '+393331111111' },
            'ANTONIO': { email: 'antonio@gruppovisconti.it', whatsapp: '+393332222222' },
            'LUIGI': { email: 'luigi@gruppovisconti.it', whatsapp: '+393333333333' },
            'DARIO': { email: 'dario@gruppovisconti.it', whatsapp: '+393334444444' },
            'NOEMI': { email: 'noemi@gruppovisconti.it', whatsapp: '+393335555555' },
            'VINCENZO': { email: 'vincenzo@gruppovisconti.it', whatsapp: '+393336666666' },
            'ROBERTO': { email: 'roberto@gruppovisconti.it', whatsapp: '+393337777777' },
            'MARIANO': { email: 'mariano@gruppovisconti.it', whatsapp: '+393338888888' }
        };

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            var date = new Date(dateString);
            return date.toLocaleDateString('it-IT');
        }

        function saveData() {
            try {
                var data = { tasks: taskManager.tasks, notifications: taskManager.notifications, lastSaved: new Date().toISOString() };
                var storage = window.localStorage || window.sessionStorage;
                if (storage) {
                    storage.setItem('gruppoViscontiTasks', JSON.stringify(data));
                    console.log('‚úÖ Dati salvati con successo');
                }
            } catch (error) {
                console.error('‚ùå Errore salvataggio:', error);
            }
        }

        function loadData() {
            try {
                var storage = window.localStorage || window.sessionStorage;
                if (storage) {
                    var savedData = storage.getItem('gruppoViscontiTasks');
                    if (savedData) {
                        var data = JSON.parse(savedData);
                        taskManager.tasks = data.tasks || [];
                        taskManager.notifications = data.notifications || [];
                        console.log('‚úÖ Dati caricati: ' + taskManager.tasks.length + ' tasks');
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('‚ùå Errore caricamento:', error);
                taskManager.tasks = [];
                taskManager.notifications = [];
                return false;
            }
        }

        function showAlert(type, title, message, duration) {
            duration = duration || 5000;
            taskManager.alertCounter++;
            var alertId = 'alert-' + taskManager.alertCounter;
            
            var alertElement = document.createElement('div');
            alertElement.id = alertId;
            alertElement.className = 'alert alert-' + type;
            alertElement.innerHTML = 
                '<button class="alert-close" onclick="closeAlert(\'' + alertId + '\')">&times;</button>' +
                '<div class="alert-title">' + title + '</div>' +
                '<div class="alert-message">' + message + '</div>';
            
            document.getElementById('alertContainer').appendChild(alertElement);
            setTimeout(function() { closeAlert(alertId); }, duration);
        }

        function closeAlert(alertId) {
            var alert = document.getElementById(alertId);
            if (alert && alert.parentNode) {
                alert.parentNode.removeChild(alert);
            }
        }

        function getTimeAgo(timestamp) {
            var now = new Date();
            var time = new Date(timestamp);
            var diffMs = now - time;
            var diffMins = Math.floor(diffMs / 60000);
            var diffHours = Math.floor(diffMs / 3600000);
            var diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Ora';
            if (diffMins < 60) return diffMins + 'm fa';
            if (diffHours < 24) return diffHours + 'h fa';
            return diffDays + 'g fa';
        }

        function addNotification(type, title, message, taskId) {
            var notification = {
                id: generateId(),
                type: type,
                title: title,
                message: message,
                taskId: taskId || null,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            taskManager.notifications.unshift(notification);
            if (taskManager.notifications.length > 50) {
                taskManager.notifications = taskManager.notifications.slice(0, 50);
            }
            
            saveData();
            renderNotifications();
            
            var alertType = type === 'overdue' ? 'danger' : 
                           type === 'deadline' ? 'warning' : 
                           type === 'completed' ? 'success' : 'info';
            
            showAlert(alertType, title, message);
        }

        function renderNotifications() {
            var notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            if (taskManager.notifications.length === 0) {
                notificationsList.innerHTML = 
                    '<div class="empty-state"><div style="font-size: 2rem; margin-bottom: 10px;">üîî</div>' +
                    '<p>Nessuna notifica al momento</p></div>';
                return;
            }

            var icons = { 'deadline': '‚è∞', 'overdue': 'üö®', 'completed': '‚úÖ', 'assigned': 'üìã', 'info': '‚ÑπÔ∏è' };
            var html = '';
            var displayNotifications = taskManager.notifications.slice(0, 10);
            
            for (var i = 0; i < displayNotifications.length; i++) {
                var notif = displayNotifications[i];
                html += '<div class="notification-item">' +
                    '<div class="notification-icon">' + (icons[notif.type] || 'üîî') + '</div>' +
                    '<div class="notification-content">' +
                    '<div class="notification-title">' + notif.title + '</div>' +
                    '<div class="notification-text">' + notif.message + '</div>' +
                    '</div>' +
                    '<div class="notification-time">' + getTimeAgo(notif.timestamp) + '</div>' +
                    '</div>';
            }
            
            notificationsList.innerHTML = html;
        }

        function addTask(event) {
            event.preventDefault();
            
            try {
                var title = document.getElementById('taskTitle').value.trim();
                var description = document.getElementById('taskDescription').value.trim();
                var assigneeSelect = document.getElementById('taskAssignee');
                var selectedAssignees = [];
                
                // Verifica che gli elementi esistano
                if (!assigneeSelect) {
                    showAlert('danger', 'Errore', 'Elemento assegnatario non trovato');
                    return;
                }
                
                for (var i = 0; i < assigneeSelect.options.length; i++) {
                    if (assigneeSelect.options[i].selected) {
                        selectedAssignees.push(assigneeSelect.options[i].value);
                    }
                }
                
                var priority = document.getElementById('taskPriority').value;
                var dueDate = document.getElementById('taskDueDate').value;
                var status = document.getElementById('taskStatus').value;
                var selectedTags = document.getElementById('selectedTags').value;
                var enableReminder = document.getElementById('enableReminder').checked;
                
                if (!title || selectedAssignees.length === 0) {
                    showAlert('danger', 'Errore', 'Inserisci almeno il titolo e seleziona un assegnatario');
                    return;
                }
                
                console.log('Creando task con:', { title, selectedAssignees, priority, status });
                
                var task = {
                    id: taskManager.editingTaskId || generateId(),
                    title: title,
                    description: description,
                    assignee: selectedAssignees,
                    priority: priority,
                    dueDate: dueDate,
                    status: status,
                    tags: selectedTags ? selectedTags.split(',') : [],
                    enableReminder: enableReminder,
                    createdAt: taskManager.editingTaskId ? 
                        (taskManager.tasks.find(function(t) { return t.id === taskManager.editingTaskId; }) || {}).createdAt || new Date().toISOString()
                        : new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: taskManager.currentUser
                };
                
                console.log('Task creato:', task);
                
                if (taskManager.editingTaskId) {
                    var taskIndex = taskManager.tasks.findIndex(function(t) { return t.id === taskManager.editingTaskId; });
                    if (taskIndex !== -1) {
                        taskManager.tasks[taskIndex] = task;
                        showAlert('success', 'Compito Aggiornato', 'Il compito √® stato aggiornato con successo');
                        addNotification('info', 'Compito Modificato', 'Il compito "' + task.title + '" √® stato aggiornato', task.id);
                    } else {
                        taskManager.tasks.push(task);
                        showAlert('success', 'Compito Aggiunto', 'Il compito √® stato creato con successo');
                    }
                    taskManager.editingTaskId = null;
                } else {
                    taskManager.tasks.push(task);
                    console.log('Tasks totali dopo aggiunta:', taskManager.tasks.length);
                    showAlert('success', 'Compito Aggiunto', 'Il compito "' + title + '" √® stato creato con successo');
                    addNotification('assigned', 'Nuovo Compito Creato', 
                        'Il compito "' + task.title + '" √® stato assegnato a ' + selectedAssignees.join(', '), task.id);
                }
                
                saveData();
                resetForm();
                renderCurrentView();
                updateStats();
                
                console.log('Task aggiunto con successo, tasks totali:', taskManager.tasks.length);
                
            } catch (error) {
                console.error('Errore in addTask:', error);
                showAlert('danger', 'Errore', 'Si √® verificato un errore durante la creazione del compito: ' + error.message);
            }
        }

        function resetForm() {
            document.getElementById('taskForm').reset();
            document.getElementById('selectedTags').value = '';
            
            var tagOptions = document.querySelectorAll('.tag-option');
            for (var i = 0; i < tagOptions.length; i++) {
                tagOptions[i].classList.remove('selected');
            }
            
            var submitButton = document.querySelector('.btn-primary');
            if (submitButton) {
                submitButton.innerHTML = '‚ûï Aggiungi Compito';
            }
            
            taskManager.editingTaskId = null;
        }

        function editTask(taskId) {
            var task = taskManager.tasks.find(function(t) { return t.id === taskId; });
            if (!task) return;
            
            taskManager.editingTaskId = taskId;
            
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description || '';
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskDueDate').value = task.dueDate || '';
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('enableReminder').checked = task.enableReminder || false;
            
            var assigneeSelect = document.getElementById('taskAssignee');
            for (var i = 0; i < assigneeSelect.options.length; i++) {
                var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                assigneeSelect.options[i].selected = assignees.indexOf(assigneeSelect.options[i].value) !== -1;
            }
            
            var tagOptions = document.querySelectorAll('.tag-option');
            for (var i = 0; i < tagOptions.length; i++) {
                var isSelected = task.tags && task.tags.indexOf(tagOptions[i].getAttribute('data-tag')) !== -1;
                tagOptions[i].classList.toggle('selected', isSelected);
            }
            updateSelectedTags();
            
            var submitButton = document.querySelector('.btn-primary');
            if (submitButton) {
                submitButton.innerHTML = '‚úèÔ∏è Aggiorna Compito';
            }
            
            document.querySelector('.task-form').scrollIntoView({ behavior: 'smooth' });
            showAlert('info', 'Modalit√† Modifica', 'Modifica i dati e clicca "Aggiorna Compito"');
        }

        function deleteTask(taskId) {
            if (!confirm('Sei sicuro di voler eliminare questo compito?')) return;
            
            var task = taskManager.tasks.find(function(t) { return t.id === taskId; });
            if (task) {
                taskManager.tasks = taskManager.tasks.filter(function(t) { return t.id !== taskId; });
                saveData();
                renderCurrentView();
                updateStats();
                
                addNotification('info', 'Compito Eliminato', 'Il compito "' + task.title + '" √® stato eliminato', taskId);
                showAlert('info', 'Compito Eliminato', 'Il compito √® stato rimosso con successo');
            }
        }

        function updateTaskStatus(taskId, newStatus) {
            for (var i = 0; i < taskManager.tasks.length; i++) {
                if (taskManager.tasks[i].id === taskId) {
                    var task = taskManager.tasks[i];
                    var oldStatus = task.status;
                    task.status = newStatus;
                    task.updatedAt = new Date().toISOString();
                    saveData();
                    renderCurrentView();
                    updateStats();
                    
                    if (newStatus === 'completato' && oldStatus !== 'completato') {
                        addNotification('completed', 'Compito Completato!', 
                            'Il compito "' + task.title + '" √® stato completato', task.id);
                    }
                    break;
                }
            }
        }

        function initializeTags() {
            var tagOptions = document.querySelectorAll('.tag-option');
            for (var i = 0; i < tagOptions.length; i++) {
                tagOptions[i].addEventListener('click', function() {
                    this.classList.toggle('selected');
                    updateSelectedTags();
                });
            }
        }

        function updateSelectedTags() {
            var selectedTags = [];
            var tagOptions = document.querySelectorAll('.tag-option.selected');
            for (var i = 0; i < tagOptions.length; i++) {
                selectedTags.push(tagOptions[i].getAttribute('data-tag'));
            }
            document.getElementById('selectedTags').value = selectedTags.join(',');
        }

        function applyFilters() {
            taskManager.filters.assignee = document.getElementById('filterAssignee').value;
            taskManager.filters.priority = document.getElementById('filterPriority').value;
            taskManager.filters.status = document.getElementById('filterStatus').value;
            renderCurrentView();
        }

        function clearFilters() {
            taskManager.filters = { assignee: 'tutti', priority: 'tutte', status: 'tutti', tags: [] };
            document.getElementById('filterAssignee').value = 'tutti';
            document.getElementById('filterPriority').value = 'tutte';
            document.getElementById('filterStatus').value = 'tutti';
            renderCurrentView();
        }

        function getFilteredTasks() {
            return taskManager.tasks.filter(function(task) {
                if (taskManager.filters.assignee !== 'tutti') {
                    var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                    if (assignees.indexOf(taskManager.filters.assignee) === -1) {
                        return false;
                    }
                }
                
                if (taskManager.filters.priority !== 'tutte' && task.priority !== taskManager.filters.priority) {
                    return false;
                }
                
                if (taskManager.filters.status !== 'tutti' && task.status !== taskManager.filters.status) {
                    return false;
                }
                
                return true;
            });
        }

        function switchView(viewType) {
            taskManager.currentView = viewType;
            
            var viewButtons = document.querySelectorAll('.btn-view');
            for (var i = 0; i < viewButtons.length; i++) {
                viewButtons[i].classList.remove('active');
                viewButtons[i].style.background = '#95a5a6';
            }
            
            var activeButton = document.getElementById('view' + viewType.charAt(0).toUpperCase() + viewType.slice(1));
            if (activeButton) {
                activeButton.classList.add('active');
                activeButton.style.background = '#667eea';
            }
            
            document.getElementById('listaView').style.display = 'none';
            document.getElementById('dashboardView').style.display = 'none';
            document.getElementById('kanbanView').style.display = 'none';
            
            if (viewType === 'lista') {
                document.getElementById('listaView').style.display = 'block';
                renderTasks();
            } else if (viewType === 'dashboard') {
                document.getElementById('dashboardView').style.display = 'block';
                renderDashboard();
            } else if (viewType === 'kanban') {
                document.getElementById('kanbanView').style.display = 'block';
                renderKanban();
            }
        }

        function renderCurrentView() {
            if (taskManager.currentView === 'lista') {
                renderTasks();
            } else if (taskManager.currentView === 'dashboard') {
                renderDashboard();
            } else if (taskManager.currentView === 'kanban') {
                renderKanban();
            }
        }

        function renderTasks() {
            var tasksGrid = document.getElementById('tasksGrid');
            var filteredTasks = getFilteredTasks();
            
            if (filteredTasks.length === 0) {
                tasksGrid.innerHTML = 
                    '<div class="empty-state">' +
                    '<div style="font-size: 4rem; margin-bottom: 20px;">üìã</div>' +
                    '<h3>Nessun compito presente</h3>' +
                    '<p>Aggiungi il tuo primo compito utilizzando il form sopra</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < filteredTasks.length; i++) {
                var task = filteredTasks[i];
                var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                var tags = task.tags || [];
                
                html += 
                    '<div class="task-card">' +
                    '<div class="task-title">' + task.title + '</div>' +
                    '<div class="task-description">' + (task.description || 'Nessuna descrizione') + '</div>' +
                    '<div class="task-meta">' +
                    '<span>üë§ ' + assignees.join(', ') + '</span>' +
                    '<span>üìÖ ' + (task.dueDate ? formatDate(task.dueDate) : 'Nessuna scadenza') + '</span>' +
                    '</div>';
                
                if (tags.length > 0) {
                    html += '<div style="margin-bottom: 15px;">';
                    for (var j = 0; j < tags.length; j++) {
                        var tagColors = {
                            'Urgente': '#e74c3c', 'Cliente': '#3498db', 'Interno': '#95a5a6',
                            'Marketing': '#e67e22', 'Sviluppo': '#27ae60', 'Vendite': '#9b59b6'
                        };
                        html += '<span style="background: ' + (tagColors[tags[j]] || '#95a5a6') + '; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7rem; margin-right: 4px;">' + tags[j] + '</span>';
                    }
                    html += '</div>';
                }
                
                html += 
                    '<div class="task-status">' +
                    '<span class="task-priority ' + taskManager.priorities[task.priority].class + '">' + taskManager.priorities[task.priority].label + '</span>' +
                    '<select class="status-select" onchange="updateTaskStatus(\'' + task.id + '\', this.value)">';
                
                for (var status in taskManager.taskStates) {
                    var selected = task.status === status ? ' selected' : '';
                    html += '<option value="' + status + '"' + selected + '>' + taskManager.taskStates[status].label + '</option>';
                }
                
                html += '</select></div>' +
                    '<div class="task-actions">' +
                    '<button class="btn-small btn-edit" onclick="editTask(\'' + task.id + '\')">‚úèÔ∏è Modifica</button>' +
                    '<button class="btn-small btn-delete" onclick="deleteTask(\'' + task.id + '\')">üóëÔ∏è Elimina</button>' +
                    '</div>' +
                    '</div>';
            }
            
            tasksGrid.innerHTML = html;
        }

        function renderDashboard() {
            renderTeamProductivity();
            renderStatusChart();
            renderTeamGrid();
        }

        function renderTeamProductivity() {
            var container = document.getElementById('teamProductivity');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var completedTasks = filteredTasks.filter(function(t) { return t.status === 'completato'; }).length;
            var totalTasks = filteredTasks.length;
            var percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            container.innerHTML = 
                '<div class="progress-bar"><div class="progress-fill" style="width: ' + percentage + '%;"></div></div>' +
                '<div style="display: flex; justify-content: space-between; margin-top: 10px;">' +
                '<span>Completati: ' + completedTasks + '</span>' +
                '<span>Totali: ' + totalTasks + '</span>' +
                '<span>' + percentage + '%</span></div>';
        }

        function renderStatusChart() {
            var container = document.getElementById('statusChart');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var statusCounts = {};
            
            for (var status in taskManager.taskStates) {
                statusCounts[status] = 0;
            }
            
            for (var i = 0; i < filteredTasks.length; i++) {
                statusCounts[filteredTasks[i].status]++;
            }
            
            var html = '';
            for (var status in statusCounts) {
                var count = statusCounts[status];
                var percentage = filteredTasks.length > 0 ? (count / filteredTasks.length) * 100 : 0;
                html += 
                    '<div style="margin-bottom: 10px;">' +
                    '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">' +
                    '<span>' + taskManager.taskStates[status].label + '</span>' +
                    '<span>' + count + '</span></div>' +
                    '<div class="progress-bar"><div class="progress-fill" style="width: ' + percentage + '%;"></div></div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderTeamGrid() {
            var container = document.getElementById('teamGrid');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var html = '';
            
            for (var i = 0; i < taskManager.teamMembers.length; i++) {
                var member = taskManager.teamMembers[i];
                var memberTasks = filteredTasks.filter(function(task) {
                    var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                    return assignees.indexOf(member) !== -1;
                });
                
                var completedTasks = memberTasks.filter(function(t) { return t.status === 'completato'; }).length;
                var percentage = memberTasks.length > 0 ? Math.round((completedTasks / memberTasks.length) * 100) : 0;
                
                html += 
                    '<div class="team-card">' +
                    '<div class="team-avatar">' + member.charAt(0) + '</div>' +
                    '<div style="font-weight: 600; margin-bottom: 5px;">' + member + '</div>' +
                    '<div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 10px;">' + memberTasks.length + ' tasks</div>' +
                    '<div class="progress-bar"><div class="progress-fill" style="width: ' + percentage + '%;"></div></div>' +
                    '<div style="font-size: 0.8rem; margin-top: 5px;">' + percentage + '% completato</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderKanban() {
            var container = document.getElementById('kanbanBoard');
            if (!container) return;
            
            var filteredTasks = getFilteredTasks();
            var columns = [
                { id: 'da-iniziare', title: 'üìã Da Iniziare', color: '#95a5a6' },
                { id: 'in-corso', title: 'üöÄ In Corso', color: '#3498db' },
                { id: 'in-revisione', title: 'üëÅÔ∏è In Revisione', color: '#f39c12' },
                { id: 'completato', title: '‚úÖ Completato', color: '#27ae60' }
            ];
            
            var html = '';
            
            for (var i = 0; i < columns.length; i++) {
                var column = columns[i];
                var columnTasks = filteredTasks.filter(function(task) {
                    return task.status === column.id;
                });
                
                html += 
                    '<div class="kanban-column">' +
                    '<div class="kanban-header" style="background: ' + column.color + ';">' +
                    column.title + ' (' + columnTasks.length + ')' +
                    '</div>';
                
                for (var j = 0; j < columnTasks.length; j++) {
                    var task = columnTasks[j];
                    var assignees = Array.isArray(task.assignee) ? task.assignee : [task.assignee];
                    
                    html += 
                        '<div class="kanban-task">' +
                        '<div style="font-weight: 600; margin-bottom: 8px;">' + task.title + '</div>' +
                        '<div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 8px;">' + (task.description || '') + '</div>' +
                        '<div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem;">' +
                        '<span>üë§ ' + assignees.join(', ') + '</span>' +
                        '<span class="task-priority ' + taskManager.priorities[task.priority].class + '">' + taskManager.priorities[task.priority].label + '</span>' +
                        '</div></div>';
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function updateStats() {
            var filteredTasks = getFilteredTasks();
            
            var totalEl = document.getElementById('totalTasks');
            var inProgressEl = document.getElementById('inProgressTasks');
            var completedEl = document.getElementById('completedTasks');
            var pendingEl = document.getElementById('pendingTasks');
            
            if (totalEl) totalEl.textContent = filteredTasks.length;
            if (inProgressEl) inProgressEl.textContent = filteredTasks.filter(function(t) { return t.status === 'in-corso'; }).length;
            if (completedEl) completedEl.textContent = filteredTasks.filter(function(t) { return t.status === 'completato'; }).length;
            if (pendingEl) pendingEl.textContent = filteredTasks.filter(function(t) { return t.status === 'da-iniziare'; }).length;
        }

        function exportAllData() {
            var allData = {
                tasks: taskManager.tasks,
                notifications: taskManager.notifications,
                exportDate: new Date().toISOString(),
                teamMembers: taskManager.teamMembers,
                version: '1.0'
            };
            
            var dataStr = JSON.stringify(allData, null, 2);
            var blob = new Blob([dataStr], { type: 'application/json' });
            var link = document.createElement('a');
            
            if (link.download !== undefined) {
                var fileName = 'GruppoVisconti_Tasks_Backup_' + new Date().toISOString().split('T')[0] + '.json';
                var url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert('success', 'Backup Creato', 'File di backup scaricato con successo');
            } else {
                showAlert('danger', 'Errore Backup', 'Download non supportato su questo browser');
            }
        }

        function importData() {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                var file = event.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            var importedData = JSON.parse(e.target.result);
                            
                            if (importedData.tasks && Array.isArray(importedData.tasks)) {
                                var confirmMsg = 'Trovati ' + importedData.tasks.length + ' compiti da importare.\n' +
                                               'Vuoi sostituire i dati attuali (' + taskManager.tasks.length + ' compiti) con quelli importati?';
                                
                                if (confirm(confirmMsg)) {
                                    taskManager.tasks = importedData.tasks;
                                    taskManager.notifications = importedData.notifications || [];
                                    
                                    saveData();
                                    renderCurrentView();
                                    renderNotifications();
                                    updateStats();
                                    
                                    showAlert('success', 'Import Completato', 
                                        'Importati con successo ' + importedData.tasks.length + ' compiti!');
                                }
                            } else {
                                showAlert('danger', 'Errore Import', 'File non valido o formato non riconosciuto');
                            }
                        } catch (error) {
                            showAlert('danger', 'Errore Import', 'Impossibile leggere il file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(function(permission) {
                    if (permission === 'granted') {
                        showAlert('success', 'Notifiche Attivate', 'Le notifiche del browser sono ora attive');
                        
                        new Notification('üìã Gruppo Visconti', {
                            body: 'Notifiche del Task Manager attivate con successo!',
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="0.9em" font-size="90">üìã</text></svg>'
                        });
                    } else {
                        showAlert('warning', 'Notifiche Negate', 'Le notifiche sono state rifiutate dal browser');
                    }
                });
            } else if (Notification.permission === 'granted') {
                showAlert('info', 'Notifiche Gi√† Attive', 'Le notifiche del browser sono gi√† attivate');
            } else {
                showAlert('warning', 'Notifiche Non Supportate', 'Questo browser non supporta le notifiche');
            }
        }

        function showNotificationModal(taskTitle, assignees) {
            var modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: center; justify-content: center;';
            
            var modalContent = document.createElement('div');
            modalContent.style.cssText = 'background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.3);';
            
            modalContent.innerHTML = 
                '<h3 style="margin-bottom: 20px; color: #2c3e50;">üì± Invia Notifiche</h3>' +
                '<p style="margin-bottom: 20px; color: #7f8c8d;">Vuoi inviare una notifica per il compito "<strong>' + taskTitle + '</strong>"?</p>' +
                '<div style="margin-bottom: 20px;"><strong>üë• Assegnatari:</strong><br>' +
                assignees.map(function(name) {
                    var contact = teamContacts[name];
                    return 'üìß ' + name + ' - ' + (contact ? contact.email : 'Email non disponibile');
                }).join('<br>') + '</div>' +
                '<div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">' +
                '<button onclick="sendWhatsAppNotification(\'' + assignees.join('|') + '\', \'' + taskTitle + '\')" style="background: #25D366; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üí¨ WhatsApp</button>' +
                '<button onclick="sendEmailNotification(\'' + assignees.join('|') + '\', \'' + taskTitle + '\')" style="background: #EA4335; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üìß Email</button>' +
                '<button onclick="closeNotificationModal()" style="background: #95a5a6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">‚ùå Chiudi</button>' +
                '</div>';
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            modal.id = 'notificationModal';
        }

        function sendWhatsAppNotification(assigneesString, taskTitle) {
            var assignees = assigneesString.split('|');
            var message = 'üìã *Nuovo Compito Assegnato*\n\n*Titolo:* ' + taskTitle + '\n*Assegnato da:* ' + taskManager.currentUser + '\n*Data:* ' + new Date().toLocaleDateString('it-IT') + '\n\nüì± Gruppo Visconti - Task Manager';
            
            for (var i = 0; i < assignees.length; i++) {
                var contact = teamContacts[assignees[i]];
                if (contact && contact.whatsapp) {
                    var whatsappUrl = 'https://wa.me/' + contact.whatsapp.replace(/[^0-9]/g, '') + '?text=' + encodeURIComponent(message);
                    window.open(whatsappUrl, '_blank');
                }
            }
            
            closeNotificationModal();
            showAlert('success', 'WhatsApp Aperto', 'Si sono aperti i link per inviare i messaggi WhatsApp');
        }

        function sendEmailNotification(assigneesString, taskTitle) {
            var assignees = assigneesString.split('|');
            var subject = 'üìã Nuovo Compito Assegnato: ' + taskTitle;
            var body = 'Ciao!\n\nTi √® stato assegnato un nuovo compito:\n\nüìã TITOLO: ' + taskTitle + '\nüë§ ASSEGNATO DA: ' + taskManager.currentUser + '\nüìÜ DATA: ' + new Date().toLocaleDateString('it-IT') + '\n\nAccedi al Task Manager per maggiori dettagli.\n\n---\nGruppo Visconti - Join the ReEvolution';
            
            for (var i = 0; i < assignees.length; i++) {
                var contact = teamContacts[assignees[i]];
                if (contact && contact.email) {
                    var mailtoUrl = 'mailto:' + contact.email + '?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);
                    window.open(mailtoUrl, '_blank');
                }
            }
            
            closeNotificationModal();
            showAlert('success', 'Email Aperta', 'Si sono aperti i client email per inviare le notifiche');
        }

        function closeNotificationModal() {
            var modal = document.getElementById('notificationModal');
            if (modal) {
                modal.remove();
            }
        }

        // Funzione di debug per verificare lo stato dell'app
        function debugApp() {
            console.log('=== DEBUG TASK MANAGER ===');
            console.log('Tasks totali:', taskManager.tasks.length);
            console.log('Tasks:', taskManager.tasks);
            console.log('Current view:', taskManager.currentView);
            console.log('Filtri attivi:', taskManager.filters);
            console.log('Filtered tasks:', getFilteredTasks().length);
            console.log('=========================');
            
            showAlert('info', 'Debug Info', 
                'Tasks: ' + taskManager.tasks.length + ' | Vista: ' + taskManager.currentView + ' | Filtrati: ' + getFilteredTasks().length);
        }

        // Funzione semplificata per aggiungere un task di test
        function addTestTask() {
            try {
                var testTask = {
                    id: generateId(),
                    title: 'Task di Test - ' + new Date().getTime(),
                    description: 'Questo √® un task di test creato automaticamente',
                    assignee: ['LUCIANO'],
                    priority: 'media',
                    dueDate: '',
                    status: 'da-iniziare',
                    tags: ['Test'],
                    enableReminder: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: 'Sistema'
                };
                
                taskManager.tasks.push(testTask);
                console.log('Task di test aggiunto:', testTask);
                console.log('Tasks totali:', taskManager.tasks.length);
                
                saveData();
                renderCurrentView();
                updateStats();
                
                showAlert('success', 'Test Task Aggiunto', 'Task di test creato con successo!');
                
            } catch (error) {
                console.error('Errore nel test task:', error);
                showAlert('danger', 'Errore Test', 'Errore nella creazione del task di test: ' + error.message);
            }
        }

        function addSampleTasks() {
            try {
                console.log('Aggiungendo dati demo...');
                
                var sampleTasks = [
                    {
                        id: generateId(),
                        title: 'Preparare presentazione Q4',
                        description: 'Creare slides per la presentazione dei risultati del quarto trimestre',
                        assignee: ['LUCIANO', 'ANTONIO'],
                        priority: 'alta',
                        dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        status: 'in-corso',
                        tags: ['Urgente', 'Cliente'],
                        enableReminder: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        createdBy: 'Admin'
                    },
                    {
                        id: generateId(),
                        title: 'Aggiornare il sito web aziendale',
                        description: 'Implementare le nuove funzionalit√† richieste dal cliente',
                        assignee: ['LUIGI', 'DARIO'],
                        priority: 'media',
                        dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        status: 'da-iniziare',
                        tags: ['Sviluppo', 'Cliente'],
                        enableReminder: false,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        createdBy: 'Admin'
                    },
                    {
                        id: generateId(),
                        title: 'Campagna marketing sui social',
                        description: 'Pianificare e lanciare la nuova campagna promozionale',
                        assignee: ['NOEMI'],
                        priority: 'media',
                        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        status: 'completato',
                        tags: ['Marketing', 'Interno'],
                        enableReminder: false,
                        createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                        updatedAt: new Date().toISOString(),
                        createdBy: 'Admin'
                    }
                ];
                
                console.log('Tasks demo da aggiungere:', sampleTasks);
                
                taskManager.tasks = taskManager.tasks.concat(sampleTasks);
                console.log('Tasks totali dopo aggiunta demo:', taskManager.tasks.length);
                
                saveData();
                renderCurrentView();
                updateStats();
                
                showAlert('success', 'Dati Demo Aggiunti', 'Sono stati aggiunti ' + sampleTasks.length + ' compiti di esempio');
                
            } catch (error) {
                console.error('Errore in addSampleTasks:', error);
                showAlert('danger', 'Errore Demo', 'Errore nell\'aggiunta dei dati demo: ' + error.message);
            }
        }

        function init() {
            console.log('üöÄ Inizializzazione Task Manager Gruppo Visconti');
            
            var dataLoaded = loadData();
            
            var taskForm = document.getElementById('taskForm');
            if (taskForm) {
                taskForm.addEventListener('submit', addTask);
            }
            
            initializeTags();
            
            renderCurrentView();
            renderNotifications();
            updateStats();
            
            if (!dataLoaded || taskManager.tasks.length === 0) {
                setTimeout(function() {
                    showAlert('info', 'Benvenuto nel Task Manager!', 
                        'Prima volta? Aggiungi il tuo primo compito o usa "üíæ Backup" per salvare i dati.', 8000);
                }, 1000);
            }
            
            console.log('‚úÖ Task Manager inizializzato con successo');
        }

        function startAutoSave() {
            setInterval(function() {
                if (taskManager.tasks.length > 0 || taskManager.notifications.length > 0) {
                    saveData();
                }
            }, 30000);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                init();
                startAutoSave();
            });
        } else {
            init();
            startAutoSave();
        }

        window.addEventListener('beforeunload', function() {
            saveData();
        });

        // Esponi funzioni per debug e test
        window.addDemoData = addSampleTasks;
        window.addTestTask = addTestTask;
        window.debugApp = debugApp;
        window.taskManager = taskManager;
    </script>
</body>
</html><!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestore Compiti - Gruppo Visconti</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .company-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .logo-text {
            font-size: 2.8rem;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .gruppo-text {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 50%, #ffb347 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .visconti-text {
            background: linear-gradient(135deg, #228b22 0%, #32cd32 50%, #90ee90 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline {
            font-size: 1rem;
            color: #ecf0f1;
            font-style: italic;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.9;
        }

        @supports not (-webkit-background-clip: text) {
            .gruppo-text { color: #ffa500; }
            .visconti-text { color: #32cd32; }
        }

        .header h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 300; }
        .header p { opacity: 0.9; font-size: 1.1rem; }

        .main-content { padding: 30px; }

        .alert-container {
            position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 400px;
        }

        .alert {
            padding: 15px 20px; border-radius: 8px; margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); animation: slideInRight 0.3s ease-out;
            position: relative; cursor: pointer;
        }

        .alert-success { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; }
        .alert-warning { background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%); color: white; }
        .alert-danger { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; }
        .alert-info { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; }

        .alert-title { font-weight: 600; margin-bottom: 5px; font-size: 1.1rem; }
        .alert-message { opacity: 0.9; line-height: 1.4; }
        .alert-close {
            position: absolute; top: 10px; right: 15px; background: none; border: none;
            color: white; font-size: 1.2rem; cursor: pointer; opacity: 0.7;
        }

        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .task-form {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 30px; margin-bottom: 30px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .section-title {
            color: white; border-bottom: 3px solid rgba(255, 255, 255, 0.3);
            font-size: 1.8rem; margin-bottom: 25px;
        }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px; font-weight: 600; color: white;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px 15px; border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; font-size: 16px; background: rgba(255, 255, 255, 0.1);
            color: white; transition: all 0.3s;
        }

        .form-group input::placeholder, .form-group textarea::placeholder { color: rgba(255, 255, 255, 0.7); }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.2);
        }

        .form-group select option { background: #2c3e50; color: white; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        .btn {
            padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: all 0.3s;
            display: inline-block; text-align: center;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.9); color: #667eea;
        }
        .btn-primary:hover { background: white; transform: translateY(-2px); }

        .btn-success { background: rgba(86, 171, 47, 0.9); color: white; margin-left: 10px; }
        .btn-purple { background: rgba(155, 89, 182, 0.9); color: white; margin-left: 10px; }

        .stats-section {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; border-radius: 10px; text-align: center;
        }
        .stat-number { font-size: 2.5rem; font-weight: 300; margin-bottom: 5px; }
        .stat-label { opacity: 0.9; font-size: 0.9rem; }

        .notifications-section {
            background: #f8f9fa; padding: 20px; border-radius: 10px;
            margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .notification-item {
            display: flex; align-items: center; padding: 12px 15px; background: white;
            border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea;
        }

        .notification-icon { font-size: 1.5rem; margin-right: 15px; }
        .notification-content { flex: 1; }
        .notification-title { font-weight: 600; color: #2c3e50; margin-bottom: 2px; }
        .notification-text { color: #7f8c8d; font-size: 0.9rem; }
        .notification-time { color: #bdc3c7; font-size: 0.8rem; margin-left: 15px; }

        .section-title {
            font-size: 1.5rem; color: #2c3e50; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 3px solid #667eea;
        }

        .tasks-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }

        .task-card {
            background: white; border-radius: 10px; padding: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-left: 5px solid #667eea;
            transition: transform 0.3s;
        }
        .task-card:hover { transform: translateY(-5px); }

        .task-title { 
            font-size: 1.2rem; font-weight: 600; color: #2c3e50; margin-bottom: 10px;
            word-wrap: break-word; overflow-wrap: break-word;
        }
        
        .task-description { 
            color: #7f8c8d; margin-bottom: 15px; line-height: 1.6;
            word-wrap: break-word; overflow-wrap: break-word;
        }

        .task-meta {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; font-size: 0.9rem;
        }

        .task-priority {
            padding: 4px 12px; border-radius: 15px; font-size: 0.8rem;
            font-weight: 600; text-transform: uppercase;
        }
        .priority-alta { background: #ffebee; color: #c62828; }
        .priority-media { background: #fff3e0; color: #ef6c00; }
        .priority-bassa { background: #e8f5e8; color: #2e7d32; }

        .task-status { display: flex; align-items: center; gap: 10px; }
        .status-select {
            padding: 8px 12px; border: 2px solid #e9ecef; border-radius: 6px;
            font-size: 14px; cursor: pointer;
        }

        .task-actions { display: flex; gap: 10px; margin-top: 15px; }

        .btn-small {
            padding: 6px 12px; font-size: 12px; border-radius: 4px;
            border: none; cursor: pointer; transition: all 0.2s;
        }

        .btn-edit { background: #3498db; color: white; }
        .btn-delete { background: #e74c3c; color: white; }
        .btn-small:hover { transform: scale(1.05); }

        .empty-state { text-align: center; padding: 60px 20px; color: #7f8c8d; }

        .tag-option {
            transition: all 0.3s; user-select: none; cursor: pointer;
        }
        .tag-option:hover { transform: scale(1.05); }
        .tag-option.selected { box-shadow: 0 0 0 3px rgba(255,255,255,0.5); }

        .btn-view { transition: all 0.3s; }
        .btn-view.active { background: #667eea !important; }

        .dashboard-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin-top: 20px;
        }

        .chart-card {
            background: white; border-radius: 10px; padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-title { font-size: 1.2rem; font-weight: 600; color: #2c3e50; margin-bottom: 15px; }

        .progress-bar {
            width: 100%; height: 20px; background: #ecf0f1; border-radius: 10px;
            overflow: hidden; margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .team-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-top: 20px;
        }

        .team-card {
            background: white; border-radius: 10px; padding: 15px; text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .team-avatar {
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 10px; font-size: 1.5rem; color: white;
        }

        .kanban-board {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin-top: 20px;
        }

        .kanban-column { background: #f8f9fa; border-radius: 10px; padding: 15px; min-height: 400px; }

        .kanban-header {
            font-weight: 600; padding: 10px; border-radius: 8px;
            margin-bottom: 15px; text-align: center; color: white;
        }

        .kanban-task {
            background: white; border-radius: 8px; padding: 15px; margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: grab; transition: transform 0.2s;
        }
        .kanban-task:hover { transform: translateY(-2px); }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .tasks-grid { grid-template-columns: 1fr; }
            .stats-section { grid-template-columns: repeat(2, 1fr); }
            .company-logo { flex-direction: column; gap: 10px; }
            .logo-text { font-size: 2.2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-logo">
                <span class="logo-text gruppo-text">GRUPPO</span>
                <span class="logo-text visconti-text">VISCONTI</span>
            </div>
            <div class="tagline">Join the ReEvolution</div>
            <h1>üìã Gestore Compiti</h1>
            <p>Organizza, monitora e traccia tutti i tuoi compiti in modo efficiente</p>
        </div>

        <div class="main-content">
            <div class="alert-container" id="alertContainer"></div>

            <!-- Form nuovo compito -->
            <div class="task-form">
                <h2 class="section-title">‚ûï Nuovo Compito</h2>
                <p style="margin-bottom: 20px; opacity: 0.9; font-size: 1.1rem;">
                    üöÄ Crea rapidamente un nuovo compito per il team
                </p>
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">Titolo Compito *</label>
                        <input type="text" id="taskTitle" required placeholder="Es: Preparare presentazione Q4" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="taskDescription">Descrizione</label>
                        <textarea id="taskDescription" placeholder="Descrivi dettagliatamente il compito da svolgere..." maxlength="500"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskAssignee">Assegnato a *</label>
                            <select id="taskAssignee" required multiple style="height: auto; min-height: 50px;">
                                <option value="LUCIANO">üë§ LUCIANO</option>
                                <option value="ANTONIO">üë§ ANTONIO</option>
                                <option value="LUIGI">üë§ LUIGI</option>
                                <option value="DARIO">üë§ DARIO</option>
                                <option value="NOEMI">üë§ NOEMI</option>
                                <option value="VINCENZO">üë§ VINCENZO</option>
                                <option value="ROBERTO">üë§ ROBERTO</option>
                                <option value="MARIANO">üë§ MARIANO</option>
                            </select>
                            <small style="color: rgba(255,255,255,0.8); font-size: 0.8rem;">Tieni premuto Ctrl per selezionare pi√π persone</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="taskTags">Tags</label>
                            <div id="taskTags" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                                <span class="tag-option" data-tag="Urgente" style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">üî• Urgente</span>
                                <span class="tag-option" data-tag="Cliente" style="background: #3498db; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">üë• Cliente</span>
                                <span class="tag-option" data-tag="Interno" style="background: #95a5a6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">üè¢ Interno</span>
                                <span class="tag-option" data-tag="Marketing" style="background: #e67e22; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">üì¢ Marketing</span>
                                <span class="tag-option" data-tag="Sviluppo" style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">üíª Sviluppo</span>
                                <span class="tag-option" data-tag="Vendite" style="background: #9b59b6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">üí∞ Vendite</span>
                            </div>
                            <input type="hidden" id="selectedTags" value="">
                        </div>
                        
                        <div class="form-group">
                            <label for="taskPriority">Priorit√†</label>
                            <select id="taskPriority">
                                <option value="bassa">üü¢ Bassa</option>
                                <option value="media" selected>üü° Media</option>
                                <option value="alta">üî¥ Alta</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskDueDate">Scadenza</label>
                            <input type="date" id="taskDueDate">
                        </div>
                        
                        <div class="form-group">
                            <label for="taskStatus">Stato Iniziale</label>
                            <select id="taskStatus">
                                <option value="da-iniziare" selected>üìã Da Iniziare</option>
                                <option value="in-corso">üöÄ In Corso</option>
                                <option value="in-revisione">üëÅÔ∏è In Revisione</option>
                                <option value="completato">‚úÖ Completato</option>
                                <option value="in-pausa">‚è∏Ô∏è In Pausa</option>
                                <option value="annullato">‚ùå Annullato</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="enableReminder" style="margin-right: 12px; transform: scale(1.2);">
                            <span>üîî Attiva promemoria automatico</span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 25px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <button type="submit" class="btn btn-primary" style="flex: 1; min-width: 200px;">
                            ‚ûï Aggiungi Compito
                        </button>
                        
                        <div style="display: flex; gap: 5px;">
                            <button type="button" class="btn-view active" id="viewLista" onclick="switchView('lista')" style="background: #667eea; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                üìã Lista
                            </button>
                            <button type="button" class="btn-view" id="viewDashboard" onclick="switchView('dashboard')" style="background: #95a5a6; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                üìä Dashboard
                            </button>
                            <button type="button" class="btn-view" id="viewKanban" onclick="switchView('kanban')" style="background: #95a5a6; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                üìå Kanban
                            </button>
                        </div>
                        
                        <button type="button" class="btn btn-success" onclick="exportAllData()" style="flex: 0 0 auto;">
                            üíæ Backup
                        </button>
                        <button type="button" class="btn btn-success" onclick="importData()" style="flex: 0 0 auto;">
                            üì• Import
                        </button>
                        <button type="button" class="btn btn-purple" onclick="requestNotificationPermission()" style="flex: 0 0 auto;">
                            üîî Notifiche
                        </button>
                    </div>
                </form>
            </div>

            <!-- Barra Filtri -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
                <div style="font-weight: 600; color: #2c3e50;">üîç Filtri:</div>
                
                <select id="filterAssignee" onchange="applyFilters()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="tutti">üë• Tutti</option>
                    <option value="LUCIANO">üë§ LUCIANO</option>
                    <option value="ANTONIO">üë§ ANTONIO</option>
                    <option value="LUIGI">üë§ LUIGI</option>
                    <option value="DARIO">üë§ DARIO</option>
                    <option value="NOEMI">üë§ NOEMI</option>
                    <option value="VINCENZO">üë§ VINCENZO</option>
                    <option value="ROBERTO">üë§ ROBERTO</option>
                    <option value="MARIANO">üë§ MARIANO</option>
                </select>
                
                <select id="filterPriority" onchange="applyFilters()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="tutte">üéØ Tutte</option>
                    <option value="alta">üî¥ Alta</option>
                    <option value="media">üü° Media</option>
                    <option value="bassa">üü¢ Bassa</option>
                </select>
                
                <select id="filterStatus" onchange="applyFilters()" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="tutti">üìã Tutti</option>
                    <option value="da-iniziare">üìã Da Iniziare</option>
                    <option value="in-corso">üöÄ In Corso</option>
                    <option value="completato">‚úÖ Completato</option>
                </select>
                
                <button onclick="clearFilters()" style="background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                    üóëÔ∏è Reset
                </button>
            </div>

            <!-- Statistiche -->
            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">Totale</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="inProgressTasks">0</div>
                    <div class="stat-label">In Corso</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">Completati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingTasks">0</div>
                    <div class="stat-label">Da Iniziare</div>
                </div>
            </div>

            <!-- Notifiche -->
            <div class="notifications-section">
                <h2 class="section-title">üîî Notifiche</h2>
                <div id="notificationsList">
                    <div class="empty-state">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üîî</div>
                        <p>Nessuna notifica al momento</p>
                    </div>
                </div>
            </div>

            <!-- Vista Lista -->
            <div id="listaView">
                <h2 class="section-title">üìå Compiti Attivi</h2>
                <div class="tasks-grid" id="tasksGrid">
                    <div class="empty-state">
                        <div style="font-size: 4rem; margin-bottom: 20px;">üìã</div>
                        <h3>Nessun compito presente</h3>
                        <p>Aggiungi il tuo primo compito utilizzando il form sopra</p>
                    </div>
                </div>
            </div>

            <!-- Vista Dashboard -->
            <div id="dashboardView" style="display: none;">
                <h2 class="section-title">üìä Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="chart-card">
                        <div class="chart-title">üìà Produttivit√† Team</div>
                        <div id="teamProductivity"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">üìã Tasks per Stato</div>
                        <div id="statusChart"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">üéØ Tasks per Priorit√†</div>
                        <div id="priorityChart"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">üë• Carico di Lavoro</div>
                        <div id="workloadChart"></div>
                    </div>
                </div>
                <div class="team-grid" id="teamGrid"></div>
            </div>

            <!-- Vista Kanban -->
            <div id="kanbanView" style="display: none;">
                <h2 class="section-title">üìå Kanban Board</h2>
                <div class="kanban-board" id="kanbanBoard"></div>
            </div>
        </div>
    </div>

    <script>
        var taskManager = {
            tasks: [],
            notifications: [],
            alertCounter: 0,
            currentUser: 'Admin',
            teamMembers: ['LUCIANO', 'ANTONIO', 'LUIGI', 'DARIO', 'NOEMI', 'VINCENZO', 'ROBERTO', 'MARIANO'],
            currentView: 'lista',
            editingTaskId: null,
            filters: { assignee: 'tutti', priority: 'tutte', status: 'tutti', tags: [] },
            taskStates: {
                'da-iniziare': { label: 'üìã Da Iniziare', class: 'status-da-iniziare' },
                'in-corso': { label: 'üöÄ In Corso', class: 'status-in-corso' },
                'in-revisione': { label: 'üëÅÔ∏è
